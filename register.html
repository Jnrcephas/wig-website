<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Create Account â€” Natishlux</title>
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* Same styles as login.html */
    :root{
      --bg:#fff;
      --text:#111;
      --muted:#666;
      --accent:#000;
      --gold:#e0245e;
      --error:#e74c3c;
      --success:#27ae60;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Jost",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      color:var(--text);
      background:var(--bg);
      line-height:1.45;
      display:flex;
      flex-direction:column;
    }
    a{color:inherit;text-decoration:none}

    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    
    header{
      border-bottom:1px solid #eee;
      background:#fff;
      padding:18px 0;
    }
    .nav{
      display:flex;align-items:center;justify-content:space-between;
    }
    .logo{font-weight:700;letter-spacing:.3px;font-size:20px}

    .auth-container{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px 20px;
      background:linear-gradient(135deg, #fafafa 0%, #fff 100%);
    }

    .auth-card{
      background:#fff;
      border-radius:16px;
      box-shadow:0 10px 40px rgba(0,0,0,0.08);
      padding:48px;
      width:100%;
      max-width:500px;
    }

    .auth-header{
      text-align:center;
      margin-bottom:32px;
    }
    .auth-header h1{
      font-size:32px;
      margin:0 0 8px;
      color:var(--gold);
      font-weight:700;
    }
    .auth-header p{
      color:var(--muted);
      margin:0;
    }

    .form-row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:16px;
    }
    .form-group{
      margin-bottom:20px;
    }
    .form-group label{
      display:block;
      margin-bottom:6px;
      font-weight:600;
      font-size:14px;
      color:var(--text);
    }
    .form-control{
      width:100%;
      padding:12px 16px;
      border:2px solid #e0e0e0;
      border-radius:8px;
      font-family:inherit;
      font-size:15px;
      transition:border-color .2s;
    }
    .form-control:focus{
      outline:none;
      border-color:var(--gold);
    }
    .form-control.error{
      border-color:var(--error);
    }

    .error-message{
      color:var(--error);
      font-size:13px;
      margin-top:4px;
      display:none;
    }
    .error-message.show{
      display:block;
    }

    .alert{
      padding:12px 16px;
      border-radius:8px;
      margin-bottom:20px;
      display:none;
    }
    .alert.show{
      display:block;
    }
    .alert-error{
      background:#fee;
      color:var(--error);
      border:1px solid var(--error);
    }

    .password-strength{
      margin-top:8px;
      font-size:13px;
    }
    .strength-bar{
      height:4px;
      background:#e0e0e0;
      border-radius:2px;
      margin-bottom:4px;
      overflow:hidden;
    }
    .strength-fill{
      height:100%;
      transition:width .3s,background .3s;
      width:0;
    }
    .strength-weak{width:33%;background:#e74c3c}
    .strength-medium{width:66%;background:#f39c12}
    .strength-strong{width:100%;background:#27ae60}

    .btn{
      width:100%;
      padding:14px;
      background:var(--accent);
      color:#fff;
      border:none;
      border-radius:8px;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
      transition:transform .2s,opacity .2s;
      margin-top:8px;
    }
    .btn:hover:not(:disabled){
      transform:translateY(-2px);
    }
    .btn:disabled{
      opacity:0.6;
      cursor:not-allowed;
      transform:none;
    }

    .auth-footer{
      text-align:center;
      margin-top:24px;
      color:var(--muted);
    }
    .auth-footer a{
      color:var(--gold);
      font-weight:600;
    }
    .auth-footer a:hover{
      text-decoration:underline;
    }

    @media (max-width:600px){
      .auth-card{
        padding:32px 24px;
      }
      .form-row{
        grid-template-columns:1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="logo" href="/">Natishlux</a>
    </div>
  </header>

  <div class="auth-container">
    <div class="auth-card">
      <div class="auth-header">
        <h1>Create Account</h1>
        <p>Join Natishlux today</p>
      </div>

      <div id="alertMessage" class="alert alert-error"></div>

      <form id="registerForm">
        <div class="form-row">
          <div class="form-group">
            <label for="firstName">First Name</label>
            <input type="text" id="firstName" class="form-control" required autocomplete="given-name">
            <div class="error-message" id="firstNameError">First name is required</div>
          </div>

          <div class="form-group">
            <label for="lastName">Last Name</label>
            <input type="text" id="lastName" class="form-control" required autocomplete="family-name">
            <div class="error-message" id="lastNameError">Last name is required</div>
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" class="form-control" required autocomplete="email">
          <div class="error-message" id="emailError">Please enter a valid email</div>
        </div>

        <div class="form-group">
          <label for="phone">Phone Number (Optional)</label>
          <input type="tel" id="phone" class="form-control" autocomplete="tel">
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" class="form-control" required autocomplete="new-password">
          <div class="password-strength">
            <div class="strength-bar">
              <div class="strength-fill" id="strengthFill"></div>
            </div>
            <span id="strengthText">At least 6 characters</span>
          </div>
          <div class="error-message" id="passwordError">Password must be at least 6 characters</div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <input type="password" id="confirmPassword" class="form-control" required autocomplete="new-password">
          <div class="error-message" id="confirmPasswordError">Passwords don't match</div>
        </div>

        <button type="submit" class="btn" id="submitBtn">
          <span id="btnText">Create Account</span>
          <span id="btnLoading" style="display:none">Creating account...</span>
        </button>
      </form>

      <div class="auth-footer">
        Already have an account? <a href="login.html">Sign in</a>
      </div>
    </div>
  </div>

  <script type="module">
    import { store } from './src/main.js';
    import { registerUser } from './src/store/slices/userSlice.js';

    const form = document.getElementById('registerForm');
    const firstNameInput = document.getElementById('firstName');
    const lastNameInput = document.getElementById('lastName');
    const emailInput = document.getElementById('email');
    const phoneInput = document.getElementById('phone');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnLoading = document.getElementById('btnLoading');
    const alertMessage = document.getElementById('alertMessage');
    const strengthFill = document.getElementById('strengthFill');
    const strengthText = document.getElementById('strengthText');

    // Password strength checker
    passwordInput.addEventListener('input', () => {
      const password = passwordInput.value;
      let strength = 0;
      
      if (password.length >= 6) strength++;
      if (password.length >= 10) strength++;
      if (/[A-Z]/.test(password) && /[a-z]/.test(password)) strength++;
      if (/\d/.test(password)) strength++;
      if (/[^A-Za-z0-9]/.test(password)) strength++;

      strengthFill.className = 'strength-fill';
      
      if (strength <= 2) {
        strengthFill.classList.add('strength-weak');
        strengthText.textContent = 'Weak password';
        strengthText.style.color = '#e74c3c';
      } else if (strength <= 4) {
        strengthFill.classList.add('strength-medium');
        strengthText.textContent = 'Medium password';
        strengthText.style.color = '#f39c12';
      } else {
        strengthFill.classList.add('strength-strong');
        strengthText.textContent = 'Strong password';
        strengthText.style.color = '#27ae60';
      }
    });

    // Clear errors on input
    [firstNameInput, lastNameInput, emailInput, passwordInput, confirmPasswordInput].forEach(input => {
      input.addEventListener('input', () => {
        input.classList.remove('error');
        document.getElementById(input.id + 'Error').classList.remove('show');
        hideAlert();
      });
    });

    // Form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      let isValid = true;
      
      const firstName = firstNameInput.value.trim();
      const lastName = lastNameInput.value.trim();
      const email = emailInput.value.trim();
      const phone = phoneInput.value.trim();
      const password = passwordInput.value;
      const confirmPassword = confirmPasswordInput.value;

      // Validate first name
      if (!firstName) {
        firstNameInput.classList.add('error');
        document.getElementById('firstNameError').classList.add('show');
        isValid = false;
      }

      // Validate last name
      if (!lastName) {
        lastNameInput.classList.add('error');
        document.getElementById('lastNameError').classList.add('show');
        isValid = false;
      }

      // Email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email || !emailRegex.test(email)) {
        emailInput.classList.add('error');
        document.getElementById('emailError').classList.add('show');
        isValid = false;
      }

      // Password validation
      if (!password || password.length < 6) {
        passwordInput.classList.add('error');
        document.getElementById('passwordError').classList.add('show');
        isValid = false;
      }

      // Confirm password validation
      if (password !== confirmPassword) {
        confirmPasswordInput.classList.add('error');
        document.getElementById('confirmPasswordError').classList.add('show');
        isValid = false;
      }

      if (!isValid) return;

      try {
        // Disable button
        submitBtn.disabled = true;
        btnText.style.display = 'none';
        btnLoading.style.display = 'inline';

        // Register user
        await store.dispatch(registerUser({
          email,
          password,
          firstName,
          lastName,
          phone
        })).unwrap();

        // Success - redirect
        const returnUrl = new URLSearchParams(window.location.search).get('return') || 'account.html';
        window.location.href = returnUrl;

      } catch (error) {
        console.error('Registration error:', error);
        showAlert(error || 'Registration failed. Please try again.', 'error');
        
        submitBtn.disabled = false;
        btnText.style.display = 'inline';
        btnLoading.style.display = 'none';
      }
    });

    function showAlert(message, type = 'error') {
      alertMessage.textContent = message;
      alertMessage.className = `alert alert-${type} show`;
    }

    function hideAlert() {
      alertMessage.classList.remove('show');
    }
  </script>
</body>
</html>