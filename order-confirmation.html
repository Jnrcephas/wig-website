<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Order Confirmation — Natishlux</title>
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#fff;
      --text:#111;
      --muted:#666;
      --accent:#000;
      --gold:#e0245e;
      --success:#27ae60;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Jost",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      color:var(--text);
      background:var(--bg);
      line-height:1.45;
    }
    a{color:inherit;text-decoration:none}

    .container{max-width:800px;margin:0 auto;padding:0 20px}
    
    header{
      border-bottom:1px solid #eee;
      background:#fff;
      padding:20px 0;
    }
    .logo{font-weight:700;letter-spacing:.3px;font-size:20px;text-align:center}

    .confirmation-container{
      text-align:center;
      padding:60px 20px;
    }

    .success-icon{
      width:80px;
      height:80px;
      background:var(--success);
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      margin:0 auto 24px;
      font-size:40px;
      color:#fff;
    }

    h1{
      font-size:clamp(28px,5vw,40px);
      margin:0 0 12px;
      color:var(--success);
    }

    .order-number{
      font-size:18px;
      color:var(--muted);
      margin-bottom:32px;
    }
    .order-number strong{
      color:var(--accent);
      font-weight:700;
    }

    .info-box{
      background:#f9f9f9;
      border:1px solid #e0e0e0;
      border-radius:12px;
      padding:24px;
      margin:32px 0;
      text-align:left;
    }
    .info-box h2{
      font-size:20px;
      margin:0 0 16px;
      color:var(--accent);
    }
    .info-row{
      display:flex;
      justify-content:space-between;
      padding:8px 0;
      border-bottom:1px solid #e0e0e0;
    }
    .info-row:last-child{
      border-bottom:none;
    }

    .order-items{
      margin:24px 0;
    }
    .order-item{
      display:flex;
      gap:16px;
      padding:16px;
      border:1px solid #e0e0e0;
      border-radius:8px;
      margin-bottom:12px;
      text-align:left;
    }
    .order-item-img{
      width:80px;
      height:80px;
      border-radius:6px;
      overflow:hidden;
      flex-shrink:0;
    }
    .order-item-img img{
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .order-item-details{
      flex:1;
    }
    .order-item-name{
      font-weight:600;
      margin:0 0 4px;
    }
    .order-item-meta{
      font-size:14px;
      color:var(--muted);
    }

    .btn{
      display:inline-block;
      padding:14px 32px;
      background:var(--accent);
      color:#fff;
      border-radius:8px;
      font-weight:600;
      margin:8px;
      transition:transform .2s;
    }
    .btn:hover{
      transform:translateY(-2px);
    }
    .btn-secondary{
      background:#f0f0f0;
      color:var(--accent);
    }

    .loading{
      text-align:center;
      padding:60px 20px;
    }
    .spinner{
      width:40px;
      height:40px;
      border:4px solid #f3f3f3;
      border-top:4px solid var(--gold);
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin:0 auto 16px;
    }
    @keyframes spin{
      0%{transform:rotate(0deg)}
      100%{transform:rotate(360deg)}
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">Natishlux</div>
  </header>

  <main>
    <div class="container">
      <!-- Loading State -->
      <div id="loadingState" class="loading">
        <div class="spinner"></div>
        <p>Loading your order...</p>
      </div>

      <!-- Success State -->
      <div id="successState" class="confirmation-container" style="display:none">
        <div class="success-icon">✓</div>
        <h1>Order Confirmed!</h1>
        <p style="font-size:18px;color:var(--muted);margin-bottom:8px">
          Thank you for your purchase!
        </p>
        <div class="order-number">
          Order Number: <strong id="orderNumber"></strong>
        </div>
        <p style="color:var(--muted);margin-bottom:32px">
          We've sent a confirmation email to <strong id="customerEmail"></strong>
        </p>

        <!-- Order Details -->
        <div class="info-box">
          <h2>Order Summary</h2>
          <div id="orderItems" class="order-items"></div>
          
          <div class="info-row">
            <span>Subtotal</span>
            <strong id="subtotal"></strong>
          </div>
          <div class="info-row">
            <span>Shipping</span>
            <strong id="shipping"></strong>
          </div>
          <div class="info-row">
            <span>Tax</span>
            <strong id="tax"></strong>
          </div>
          <div class="info-row">
            <span style="font-size:18px;font-weight:700">Total</span>
            <strong id="total" style="font-size:18px;color:var(--accent)"></strong>
          </div>
        </div>

        <!-- Shipping Address -->
        <div class="info-box">
          <h2>Shipping Address</h2>
          <div id="shippingAddress"></div>
        </div>

        <!-- Actions -->
        <div style="margin-top:32px">
          <a href="shop.html" class="btn">Continue Shopping</a>
          <a href="index.html" class="btn btn-secondary">Back to Home</a>
        </div>
      </div>

      <!-- Error State -->
      <div id="errorState" class="confirmation-container" style="display:none">
        <div class="success-icon" style="background:var(--gold)">✕</div>
        <h1 style="color:var(--gold)">Order Not Found</h1>
        <p style="color:var(--muted)">
          We couldn't find this order. Please check your order number or email.
        </p>
        <a href="index.html" class="btn" style="margin-top:24px">Back to Home</a>
      </div>
    </div>
  </main>
<script type="module">
  import { paymentAPI } from './src/services/apiMethods.js';

  async function loadOrderConfirmation() {
    const urlParams = new URLSearchParams(window.location.search);
    const sessionId = urlParams.get('session_id');

    if (!sessionId) {
      showError();
      return;
    }

    try {
      const response = await paymentAPI.getSession(sessionId);
      const data = response.data.data;

      // Check payment status
      if (data.paymentStatus !== 'paid') {
        showError();
        return;
      }

      displayOrder(data);
    } catch (error) {
      console.error('Failed to load order:', error);
      showError();
    }
  }

  function displayOrder(data) {
    document.getElementById('loadingState').style.display = 'none';
    document.getElementById('successState').style.display = 'block';

    // Order number (use session ID or order ID if available)
    const orderNumber = data.orderId || data.sessionId;
    document.getElementById('orderNumber').textContent = orderNumber;
    document.getElementById('customerEmail').textContent = data.customerEmail;

    // Order items
    const itemsContainer = document.getElementById('orderItems');
    data.items.forEach(item => {
      const itemEl = document.createElement('div');
      itemEl.className = 'order-item';
      itemEl.innerHTML = `
        <div class="order-item-img">
          <img src="${item.image || 'assets/img/placeholder.jpg'}" alt="${item.name}">
        </div>
        <div class="order-item-details">
          <div class="order-item-name">${item.name}</div>
          <div class="order-item-meta">Quantity: ${item.quantity} × $${(item.price / 100).toFixed(2)}</div>
        </div>
        <div style="text-align:right;font-weight:600">
          $${(item.quantity * item.price / 100).toFixed(2)}
        </div>
      `;
      itemsContainer.appendChild(itemEl);
    });

    // Pricing
    const subtotal = data.amountSubtotal / 100;
    const shipping = data.shippingCost ? data.shippingCost / 100 : 0;
    const tax = data.amountTax ? data.amountTax / 100 : 0;
    const total = data.amountTotal / 100;

    document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
    document.getElementById('shipping').textContent = shipping === 0 ? 'FREE' : `$${shipping.toFixed(2)}`;
    document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
    document.getElementById('total').textContent = `$${total.toFixed(2)}`;

    // Shipping address
    const address = data.shippingAddress;
    if (address) {
      document.getElementById('shippingAddress').innerHTML = `
        <p style="margin:0;line-height:1.6">
          ${data.customerName || ''}<br>
          ${address.line1}<br>
          ${address.line2 ? address.line2 + '<br>' : ''}
          ${address.city}, ${address.state} ${address.postal_code}<br>
          ${address.country}
        </p>
      `;
    }
  }

  function showError() {
    document.getElementById('loadingState').style.display = 'none';
    document.getElementById('errorState').style.display = 'block';
  }

  // Load order on page load
  loadOrderConfirmation();
</script>
</body>
</html>